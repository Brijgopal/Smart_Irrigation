<!DOCTYPE html>
<html>

<body>

	<h1>IoT Plant</h1>


	<button type="button" onclick="publish('ON')">Auto Mode ON</button>
	<button type="button" onclick="publish('OFF')">Auto Mode OFF</button>
	<button type="button" onclick="publish('WATER')">Water Plant</button>

	<p id="sensorData">Temperature and Humidity Data</p>

	<div id="chart"></div>

	<script type="text/javascript" src="https://pubnub.github.io/eon/v/eon/1.0.0/eon.js"></script>
	<link type="text/css" rel="stylesheet" href="https://pubnub.github.io/eon/v/eon/1.0.0/eon.css" />

	<script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.20.2.js"></script>

	<script>

		const pubnub = new PubNub({
			publishKey: 'pub-c-c823b87a-2007-4df2-88da-ad535587f882',
			subscribeKey: 'sub-c-4143a002-4a53-11e9-bc27-728c10c631fc',
		});


		function publish(a) {
			const publishConfig =
			{
				channel: "ch1",
				message: a
			};

			pubnub.publish(publishConfig, function (status, response) {
				console.log(status, response);
			});
		}
		
		eon.chart({
			channels: ['eon-chart'],
			history: true,
			flow: true,
			pubnub: pubnub,
			generate: {
				bindto: '#chart',
				data: {
					labels: false
				}
			}
		});
		
		pubnub.addListener({
			message: function (m) {
				// handle message
				const msg = m.message;
                
                if(msg)
				    document.getElementById("sensorData").innerHTML = msg;

				console.log(msg)
			},
			presence: function (p) {
				// handle presence
				const action = p.action;
			},
			status: function (s) {
				const affectedChannelGroups = s.affectedChannelGroups;
			}
		});

		pubnub.subscribe({
			channels: ['ch2'],

		});

        
		/* setInterval(function () {
			pubnub.publish({
				channel: 'eon-chart',
				message: {
					eon: {
						'Austin': Math.floor(Math.random() * 99),
						'New York': Math.floor(Math.random() * 99),
						'San Francisco': Math.floor(Math.random() * 99),
						'Portland': Math.floor(Math.random() * 99)
					}
				}
			});
		}, 1000); */

	</script>


</body>

</html>